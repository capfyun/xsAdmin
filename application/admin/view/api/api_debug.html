<div class="pageContent">
	<form method="post" action="{:url()}" class="pageForm required-validate" onsubmit="return admin.api.debugStart(this); return validateCallback(this, navTabAjaxDone);">
		<div class="pageFormContent" layoutH="56">
			<input name="api_id" type="hidden" value="{:input('api_id',0)}" />
			<div style="float:left;width:30%;">
				<div class="unit">
					<label style="width:auto;color:#999;"><h1>接口URL：</h1></label>
					<span>{$data.info.url}</span>
				</div>
				<div class="divider"></div>
				<div class="unit">
					<label style="width:auto;color:#999;"><h1>接口名称：</h1></label>
					<span>{$data.info.name}</span>
				</div>
				<div class="divider"></div>
				<div class="unit">
					<label style="width:auto;color:#999;"><h1>接口作者：</h1></label>
					<span>{$data.info.author}</span>
				</div>
				<div class="divider"></div>
				<div class="unit">
					<label style="width:auto;color:#999;margin-bottom:5px;"><h1>接口参数：</h1></label>
					<div class="unit">
					{volist name="data.info.param" id="vo"}
						<div class="unit">
							<span style="width:90%;display:block;text-align:left;font-weight: bold;">
								<span style="color:#30A9E1;">{$vo}</span>
								<span style="color:#999;">
									{$data['info']['explain'][$vo]['title']} {$data['info']['explain'][$vo]['type'].'类型'} {$data['info']['explain'][$vo]['explain'] ? '必填' : '选填'}
								</span>
							</span>
							<span style="display:block;">
								<input name="{$vo}" type="text" class="text" value="{:session($vo,'','api')}" placeholder="{$data['info']['explain'][$vo]['explain']}" style="margin-bottom:10px; margin-top:2px; width:90%; background-color:#F6F6F6;" >
							</span>
						</div>
					{/volist}
					</div>
				</div>
			</div>
			<div style="float:left; width:38%; height:95%; margin:3px;">
				<div>接口调试结果：</div>
				<textarea readonly="readonly" style="font-family:sans-serif; width:100%; height:100%;" id="json_input" spellcheck="false"></textarea>
			</div>
			<div style="float:left; width:30%; height:95%; margin:3px;">
				<div>返回字段说明：</div>
				<textarea readonly="readonly" style="font-family:sans-serif; width:100%; height:100%;" spellcheck="false">{$data.info.description}</textarea>
			</div>
		</div>
		<div class="formBar">
			<ul style="float:left;">
				<li><div class="buttonActive"><div class="buttonContent"><button type="submit">调试</button></div></div></li>
				<li><div class="button"><div class="buttonContent"><button type="button" class="close">取消</button></div></div></li>
			</ul>
		</div>

		<div id='container'></div>

	</form>
</div>
<script type="text/javascript" src="/static/admin/js/json/jsl.js"></script>
<script type="text/javascript">
$.extend(admin.api,{
	/**
	 * 接口调试请求
	 */
	debugStart 			: function(obj){ 		//调试接口
//		if(admin.loading == true){ return false; } admin.loading = true;
		var thisForm 	= $(obj);
		$.post(thisForm.attr("action"),thisForm.serialize(),function(data){
			try {
				if(typeof JSON == 'object'){
					thisForm.find('#json_input').val(JSON.stringify(JSON.parse(data), null, "    "));
				}else{
					thisForm.find('#json_input').val( jsl.format.formatJson(data) );
				}
			} catch(e) {
				thisForm.find('#json_input').val( data );
				alertMsg.info('接口出错：<br/>'+e);
			}
//			admin.loading = false;
		});
		return false;
	},
});
</script>
